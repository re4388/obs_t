
建立三次
![[IMG-四次握手 中斷連線-20241106133211324.png]]

結束四次
![[IMG-四次握手 中斷連線-20241106133211549.png]]


這個過程的主要目的是**確保雙方都能夠正確地關閉連接**，並且所有的數據都已經被傳送和接收。


### 四次揮手的過程

1. **FIN（終止）**：
    - 當一方（通常是客戶端）希望終止連接時，它會發送一個 FIN（終止）報文段，表示它已經沒有數據要發送了。
    - 例子：客戶端發送的報文可能是 `FIN, seq=x`，其中 `x` 是客戶端的序列號。
2. **ACK（確認）**：
    - 伺服器收到這個 FIN 報文後，會回應一個 ACK（確認）報文段，表示它已經收到了客戶端的終止請求。此時，伺服器可能仍然有數據需要發送。
    - 例子：伺服器的回應報文可能是 `ACK, seq=y, ack=x+1`，其中 `y` 是伺服器的序列號，`x+1` 是對客戶端 FIN 的確認。
3. **FIN（終止）**：
    - 當伺服器完成所有數據的發送後，它也會發送一個 FIN 報文段，表示它也沒有數據要發送了。
    - 例子：伺服器發送的報文可能是 `FIN, seq=y+1`。
4. **ACK（確認）**：
    - 客戶端收到伺服器的 FIN 報文後，會發送一個 ACK（確認）報文段，表示它已經收到了伺服器的終止請求。
    - 例子：客戶端的回應可能是 `ACK, seq=x+1, ack=y+2`。

### 為什麼需要四次揮手？

- **雙向關閉**：TCP 是一個全雙工協議，這意味著雙方都可以同時發送和接收數據。因此，當一方希望終止連接時，必須確保另一方也能夠完成它的數據傳輸並正常關閉連接。
- **確保數據完整性**：在關閉連接之前，必須確保所有數據都已經被成功傳送和接收。四次揮手的過程確保了這一點。
- **狀態管理**：這個過程能夠讓雙方在不同的狀態下進行連接的關閉，確保不會遺漏任何數據或確認。


![[IMG-四次握手 中斷連線-20241106133211776.png|781]]


ref:
[(432) 網路基礎18- 了解TCP與UDP（二） - YouTube](https://www.youtube.com/watch?v=0Gw27pXnqMU&list=PLX8pvRCsO71PCwA_AgWwDO8TI503XdXiG&index=19)