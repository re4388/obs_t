
[[BE - 阻擋與封鎖名單機制 - Plan and Prepare API doc]]


---


## Background

2024/6/15 我們的系統受到外部惡意攻擊，外部人士在四小時內異常嘗試登入多次，系統發出超過 50,000 則簡訊驗證碼訊息（跨國簡訊）。為了避免類似情況發生，短期先安排此案，在註冊、登入流程加上異常阻擋的流程。

log -> [Elastic](https://kibana.wemoscooter.com/goto/8fde14c0-3393-11ef-a8e6-d19bf97481a2)
![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003104933741.png]]




## Scope
1. 註冊及登入流程的調整
2. App - User App
3. Web - Apollo
4. Backend - 異常阻擋及黑名單機制


## User Story

1. 參考 [專案文件 > User Story](https://docs.google.com/document/d/1_qRpvri3BCf4NBgF6CL6wRuurkIO81Rg0sZnOukQ_b0/edit#heading=h.v15y0lwjgatd) 標題
# Feature ⚙️

`請放上 Feature Ticket URL、需求說明、功能規格、設計規格等資訊`

## 1. Feature 卡

[[Feature][註冊登入] 新增異常阻擋與封鎖名單機制](https://app.asana.com/0/1206167808229889/1207587336703388/f)

## 2. 專案文件

[[PRD] 註冊登入：新增異常阻擋流程](https://docs.google.com/document/d/1_qRpvri3BCf4NBgF6CL6wRuurkIO81Rg0sZnOukQ_b0/edit?usp=sharing)

## 3. 設計規格

1. [Flow](https://www.figma.com/board/OpzZy9GGki5tsYXIaj5GOw/%E8%A8%BB%E5%86%8A%E6%B5%81%E7%A8%8B%E5%84%AA%E5%8C%96?node-id=2277-24528&t=tgvjzob44YaI8nS8-0)
2. [User App - UI](https://www.figma.com/design/w7lOyqJcGXZhC1xpPUxiiq/WeMo-App?node-id=22311-1648&t=aW9Z9Rjw6INyjgtZ-0)
3. [Apollo - UI](https://www.figma.com/design/8GORW3KqwUKkyB1QrXCMf7/Apollo?node-id=9650-2&t=tjOQqY9iWYZnDv8p-0)

![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003104948762.png]]




![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003105000906.png|547]]



![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003105017563.png]]
備註：  
新增「手機號碼封鎖名單」  
可以切換各國手機號碼開頭（規則和 User App 一樣）  
封鎖原因：異常註冊/登入（系統） / 異常註冊/登入（人工）  
有剩餘時間就顯示時間，若為永久封鎖就顯示「永久」  
若正常 user 因操作不當被關小黑屋封鎖的話，可以手動解除封鎖  
可手動新增封鎖手機號碼







![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003105043493.png]]
備註：  
解除封鎖前需顯示再確認，避免操作人員誤觸


![[IMG-PM DOC 註冊登入：新增異常阻擋流程-20241003105106027.png]]
備註：  
可以切換各國手機號碼開頭（規則和 User App 一樣）  
人工封鎖手機號碼為永久性封鎖




# 專案規格文件

## Background

2024/6/15 我們的系統受到外部惡意攻擊，外部人士在四小時內異常嘗試登入多次，系統發出超過 50,000 則簡訊驗證碼訊息（跨國簡訊）。為了避免類似情況發生，短期先安排此案，在註冊、登入流程加上異常阻擋的流程。

## User Story

### 註冊流程

10 分鐘 3 次鎖定 180 分鐘

#### 4.1 作為一個 UIUX 團隊成員，我希望

- (4.1.1) 新註冊用戶在同一個註冊流程中（從 App First Launch 頁點下「註冊/登入」按鈕後開始算），輸入「手機號碼」若輸入超過 3 組以上不同號碼，當輸入第 4 組號碼時，顯示「系統發生異常，請重新操作」Toast，且頁面返回 App First Launch 頁。
- (4.1.2) 新註冊用戶若在 10 分鐘內點擊「重新傳送驗證碼」超過 3 次，第 4 次點擊時，顯示「嘗試次數過多，已被限制操作 24 小時」Toast，且頁面返回 App First Launch 頁。
    

#### 4.2 作為一個 PM 團隊成員，我希望

- 當新註冊用戶踩到 (4.1.2) 情境時，系統自動將該用戶加入黑名單 180 分鐘，在 180 分鐘內用戶重新點 App First Launch 頁的「註冊/登入」時，顯示「嘗試次數過多，已被限制操作 24 小時」Toast；當該用戶被加入黑名單超過 180 分鐘，自動移除黑名單。
    

### 登入流程

#### 4.3 作為一個 UIUX 團隊成員，我希望

- 當用戶在 10 分鐘內點擊「重新傳送驗證碼」超過 3 次，第 4 次點擊時，顯示「嘗試次數過多，已被限制操作 24 小時」Toast，且頁面返回 App First Launch 頁。若用戶再次按下「註冊/登入」按鈕，再次跳出相同錯誤提示，並且停留在原畫面。
    

### 黑名單機制

#### 4.4 作為一個 CS 團隊成員，我希望

- 查詢功能
    

- 當新註冊用戶踩到 (4.1.2) 情境時，我可以在 Apollo > 使用者 > 手機號碼黑名單 中，使用「手機號碼」查詢用戶黑名單狀態。
    
- 若用戶由系統自動加到黑名單中，查詢時，黑名單原因會顯示「異常註冊／登入（系統）」。
    
- 若用戶由人工加到黑名單中，查詢時，黑名單原因會顯示「異常註冊／登入（人工）」。
    

- 設置黑名單功能
    

- 我希望 Apollo > 使用者 > 手機號碼黑名單 功能，可使用「手機號碼」人工將用戶設定至黑名單，且除非人工解除，否則一輩子待在黑名單中。👻
    
- 我希望 Apollo > 使用者 > 手機號碼黑名單 功能，可使用「手機號碼」人工將用戶解除黑名單。
    

  
  
  

---

  
  

# 暫時準備區

## 註冊流程

調整說明：新增阻擋異常註冊的流程

- 在同一次註冊流程中（從按下「註冊/登入」按鈕，起算流程起點），當用戶輸入「身分證字號」驗證成功 (Gatekeeper: Firebase App Check) 並勾選「同意條款」後，進入手機號碼驗證流程。
    
- 輸入手機號碼：
    

- 接續前個項目，若用戶嘗試輸入超過 3 組不同手機號碼，當用戶輸入第 4 組手機號碼時，跳出錯誤提示 (1)（例如：系統發生異常請重新嘗試等。因此情境屬異常註冊情境，提示上無需明確說明。），並且畫面返回 App First Launch 頁，流程結束。
    

- 輸入手機號碼：
    

- 若用戶在 10 分鐘內，點擊「傳送驗證碼」按鈕超過 3 次，當用戶第 4 次按下按鈕，阻擋用戶繼續進行流程，跳出錯誤提示 (2)（例如：登入過於頻繁，請明天再試等。），並畫面返回 App First Launch 頁面。
    
- 若用戶再次按下「註冊/登入」按鈕，再次跳出相同錯誤提示 (2)，並且停留在原畫面。
    

  

需要 UIUX 支援的項目：

1. 更新註冊流程的 UI Flow
    
2. 異常註冊流程的錯誤提示 UI
    

## 登入流程

調整說明：新增阻擋異常登入的流程，10 分鐘內點「傳送驗證碼」超過 3 次，阻擋用戶登入 180 分鐘。

### USER APP

- 當用戶輸入「身分證字號」驗證成功 (Gatekeeper: Firebase App Check)，進入手機號碼驗證流程
    
- 輸入手機驗證碼：
    

- 若用戶在 10 分鐘內，點擊「重新傳送驗證碼」按鈕超過 3 次，當用戶第 4 次按下按鈕，阻擋用戶繼續進行流程，跳出錯誤提示 (2)（例如：登入過於頻繁，請明天再試等。），並畫面返回 App First Launch 頁面。
    
- 若用戶再次按下「註冊/登入」按鈕，再次跳出相同錯誤提示 (2)，並且停留在原畫面。
    

### APOLLO

- 新增查詢用戶帳號是否被加入黑名單的功能，以「用戶電話號碼」查詢
    
- 新增解除用戶帳號遭系統阻擋登入 180 分鐘的限制，以「用戶電話號碼」解除
    
- 新增設定用戶至黑名單的功能，以「用戶電話號碼」設定
    

  

需要 UIUX 支援的項目：

1. 更新登入流程的 UI Flow
    
2. 異常登入流程的錯誤提示 UI
    

**