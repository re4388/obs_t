related:
- [public crypto from 9個改變世界的算法](https://www.notion.so/nture4388/public-crypto-from-9-59ca73cb334949e9bea315482ebd417b?pvs=4)


- 傳遞秘密
    - A產生一組配對的公私鑰
    - A把公鑰給B
	    - 公鑰過網路沒差，看到的人無法推論出私鑰
    - B用公鑰加密一組 secret，傳給A
    - 只有私鑰解密，解出 secret, 因此 A 可以解出 secret
    - 後續A, B 就可以用此 secret，作為對稱加密來加密後續內容來互相溝通

## 公私鑰應用
### SSH 機制

SSH 登錄背後的私鑰和公鑰機制使用非對稱加密來安全地驗證用戶，而無需密碼。以下是該過程的分解：

- key generation:
    - 用戶生成一對密鑰：私鑰和公鑰。
    - 私鑰保存在用戶的設備上，保持秘密。
    - 公鑰可以與任何人共享，包括伺服器。
- **在伺服器上存儲公鑰**
    - 用戶的公鑰存儲在伺服器的 ~/.ssh/authorized_keys 文件中。
    - 這告訴伺服器哪些密鑰被授權進行 SSH 訪問。
- SSH 登錄過程
    - 客戶端發起連接：
	    - 用戶嘗試使用 SSH 連接到伺服器。
	    - **客戶端發送公鑰以告知伺服器它正在使用哪對密鑰進行身份驗證**。
		    - 因為server 那邊有很多組
    - 伺服器驗證公鑰：
	    - 伺服器檢查公鑰是否與 authorized_keys 文件中的任何條目匹配。
	    - 如果找到匹配，**伺服器生成一個挑戰：一條隨機消息（隨機數）並使用公鑰進行加密**。
    - 客戶端解密挑戰：
	    - 客戶端接收加密的挑戰。
	    - **由於客戶端持有私鑰，它可以解密該消息**。
    - 客戶端發送證明：
	    - 客戶端將解密的挑戰（原始消息）發回伺服器。
	    - **只有持有相應私鑰的客戶端才能成功解密挑戰**。
    - 伺服器驗證證明：
	    - 伺服器檢查解密的消息是否與原始挑戰匹配。
	    - 如果證明正確，則客戶端被驗證，SSH 會話建立。
要點：
• 公鑰：與伺服器共享；用於加密挑戰。 
• 私鑰：由客戶端保密；用於解密挑戰。
• 挑戰-響應機制：在不需要傳輸密碼的情況下驗證客戶端的身份。

這一機制提供了安全的無密碼登錄，因為在過程中私鑰從未暴露，任何沒有私鑰的未授權方都無法進行身份驗證。






### web ssl 機制
私鑰和公鑰機制是 SSL/TLS 握手的核心，
該握手用於在瀏覽器和網站之間建立安全連接。以下是其工作原理：

- 瀏覽器發起連接
	- 用戶輸入 SSL 保護網站的 URL（即 https://）。
	- 瀏覽器（客戶端）向伺服器發送請求以啟動安全連接，表明它支持 SSL/TLS 加密。
- 伺服器回應公鑰
	- **伺服器回應並發送其 SSL 證書，其中包含其公鑰和其他信息**（例如伺服器的域名、發證機構和證書的有效期）。
	- **瀏覽器使用證書授權機構（CAs）來驗證 SSL 證書的真實性**，這些是受信任的第三方實體，已簽署伺服器的證書。
- 瀏覽器驗證證書
	- 瀏覽器檢查：
	    - 證書是否有效（未過期）。
	    - 證書是否由受信任的證書授權機構簽署。
	    - 證書的域名是否與網站的域名匹配。
	    - 如果證書通過這些檢查，瀏覽器將信任公鑰。
- 瀏覽器生成對稱密鑰
    - 此時，瀏覽器生成一個會話密鑰（對稱密鑰）。
    - 對稱加密比非對稱加密更快，用於加密瀏覽器和伺服器之間的實際通信。
- 使用伺服器的公鑰加密會話密鑰
    - **瀏覽器使用伺服器的公鑰加密會話密鑰(session key)**。
    -  然後將這個加密的會話密鑰發送給伺服器。
- 伺服器解密會話密鑰
    - 伺服器使用其私鑰解密瀏覽器發送的會話密鑰。
    -  **此時，瀏覽器和伺服器都知道相同的會話密鑰，該密鑰將用於後續的通信**。
- **使用對稱加密進行安全通信**
    - 在會話密鑰到位後，伺服器和瀏覽器使用此密鑰加密和解密在會話期間交換的所有進一步數據。
    -  對稱加密用於速度和效率，而初始交換（握手）則使用非對稱加密以確保安全性。

要點：
- 公鑰：由伺服器在 SSL 證書中發送，瀏覽器用於加密會話密鑰。 
- 私鑰：由伺服器保密，用於解密會話密鑰。 • 會話密鑰：一個臨時的對稱密鑰，用於在會話期間瀏覽器和伺服器之間的快速安全通信。
- 這一 SSL/TLS 握手確保敏感數據（如密碼、信用卡信息等）在互聯網上安全傳輸，防止竊聽或篡改。



### 數字簽名

簽名流程
- 把資料 hash -> digest
- 簽名者產生 pri/pub key pair
- 用 pri key 加密 digest -> 得到"加密後的digest" 這就是簽名
- 資料和簽名就是一起的。

驗證流程 (證明這個數據真的是那個簽名者的)
- 看"誰"可以把 簽名 解密且拿到原本的 digest，那個"誰"就是這個資料的簽發者。
- 因為只有簽名者的 pub key 可以解密 

![[CleanShot 2024-10-19 at 18.31.56.png]]




### Passkey 通行密鑰

定義：密碼鍵是一種新型的身份驗證方法，旨在取代傳統的密碼。它通常基於公鑰加密技術，並且可以在多個設備之間安全地使用。

工作原理：
- 用戶在設備上生成一對密鑰：公鑰和私鑰。
- 公鑰存儲在伺服器上，而私鑰保存在用戶的設備上。
- 登錄時，伺服器會發送挑戰，設備使用私鑰進行簽名，然後將簽名發回伺服器進行驗證。
- 通常MacOS會讓你用 touch 來進入 keychain 拿到 私鑰，讓你 UX 體驗很好

目的：提供更安全且無需記憶密碼的登錄體驗，減少因密碼弱或重複使用而導致的安全風險。


- ref:
    - [GitHub Introduces Passkey Support | Hacker News](https://news.ycombinator.com/item?id=36717405)
    - [Passkeys Public Beta | Hacker News](https://news.ycombinator.com/item?id=36697650)