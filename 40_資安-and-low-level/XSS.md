related:
- [notion note](https://www.notion.so/nture4388/XSS-f49f1994cf0147d296aeb3d462c3fbad?pvs=4)

Cross-Site Scripting，跨站腳本攻擊


# 定義


XSS 是一種攻擊方式，**攻擊者將惡意腳本注入到網站中，當其他用戶訪問該網站時，這些腳本會在用戶的瀏覽器中執行**。這種攻擊可以用來竊取用戶的 Cookie、會話令牌或其他敏感信息。

## 工作原理
1. 攻擊者在網站的輸入框中注入惡意 JavaScript 代碼（例如，評論區、聊天框等）。
2. 當其他用戶查看該頁面時，瀏覽器執行了這段惡意代碼。
3. 攻擊者可以利用這段代碼來竊取信息、劫持會話或進行其他惡意操作。

## 防範措施
- 對用戶輸入進行嚴格的過濾和轉義，防止注入惡意代碼。
- 使用內容安全策略（CSP）來限制可執行的腳本來源。
- 確保所有輸出到頁面的數據都是安全的，並避免直接插入用戶輸入的內容。



# XSS 如何影響基於令牌的身份驗證

1. **令牌存儲**：
    - **本地存儲 / 會話存儲**：如果 JWT 存儲在 `localStorage` 或 `sessionStorage` 中，則它們可以被頁面上的 JavaScript 訪問。如果攻擊者能夠通過 XSS 注入腳本，他們可以輕易讀取令牌並將其發送到自己的伺服器。
    - **Cookies**：如果 JWT 存儲在 cookies 中，則如果這些 cookies 沒有設置為 `HttpOnly`，則可以被 JavaScript 訪問。攻擊者可以通過 XSS 攻擊訪問非 HttpOnly 的 cookies。
2. **令牌盜竊**：
    - 一旦攻擊者獲得 JWT，他們可以用它來冒充用戶。這可能導致未經授權訪問敏感數據或應用程序中的操作。
3. **會話劫持**：
    - 通過盜竊的 JWT，攻擊者可以劫持用戶會話。如果應用程序沒有適當的會話管理（例如檢查令牌過期或在登出時使令牌失效），攻擊者可以在令牌過期之前進行合法用戶的操作。

### 場景
1. **漏洞**：一個網頁應用程序存在 XSS 漏洞，允許攻擊者將 JavaScript 代碼注入到頁面中。
2. **注入**：攻擊者注入的腳本在用戶訪問受損頁面時執行。
3. **令牌訪問**：注入的腳本讀取 `localStorage` 中的 JWT 或非 HttpOnly 的 cookie，然後將其發送到攻擊者的伺服器。
4. **冒充**：攻擊者使用盜竊的令牌向伺服器發送請求，冒充合法用戶。

### 緩解策略

為了減少與 XSS 和基於令牌的身份驗證相關的風險，可以考慮以下策略：

1. **使用 HttpOnly Cookies**：
    - 將 JWT 存儲在設置了 `HttpOnly` 標誌的 cookies 中。這樣可以防止 JavaScript 訪問這些 cookies，使攻擊者更難通過 XSS 盜取令牌。
2. **內容安全策略（CSP）**：
    - 實施強大的內容安全策略，以幫助減少 XSS 的風險，控制哪些腳本可以在頁面上運行。
3. **輸入驗證和過濾**：
    - 確保所有用戶輸入都經過適當的驗證和過濾，以防止注入攻擊。
4. **定期安全審計**：
    - 定期進行安全審計和滲透測試，以識別和修復應用程序中的潛在漏洞。
5. **令牌過期和輪換**：
    - 使用短期有效的令牌並實施刷新令牌。這樣可以限制攻擊者使用盜竊令牌的時間。
6. **監控異常活動**：
    - 實施日誌記錄和監控，以檢測可能表明令牌盜竊或濫用的異常活動。